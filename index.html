<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Tracking V24 - Logout System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root { --orange: #ff8c00; --green: #28a745; --red: #dc3545; --bg: #fffaf5; }
        body { font-family: 'Prompt', sans-serif; background: var(--bg); }
        .hidden { display: none !important; }
        .glass-card { background: white; border-radius: 15px; border: 1px solid #eee; box-shadow: 0 4px 15px rgba(0,0,0,0.05); padding: 20px; margin-bottom: 20px; }
        .btn-orange { background: var(--orange); color: white; border-radius: 50px; font-weight: 600; border: none; padding: 10px 20px; transition: 0.3s; }
        .btn-logout { background: #f8d7da; color: var(--red); border: 1px solid #f5c2c7; border-radius: 10px; font-size: 0.8rem; padding: 4px 12px; font-weight: 600; transition: 0.2s; }
        .btn-logout:hover { background: var(--red); color: white; }
        .stat-box { border-left: 5px solid var(--orange); background: #fff; padding: 10px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; }
        .badge-count { position: absolute; top: 5px; right: 10px; background: var(--orange); color: white; border-radius: 50%; width: 22px; height: 22px; font-size: 0.75rem; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .nav-btn { flex: 1; border-radius: 12px; font-weight: 600; }
        .table-custom { font-size: 0.85rem; text-align: center; }
        .table-custom thead { background: var(--orange); color: white; }
    </style>
</head>
<body>

<div id="loginSection" class="container d-flex align-items-center justify-content-center" style="min-height:100vh;">
    <div class="glass-card text-center shadow" style="max-width:400px; width:100%;">
        <h3 class="fw-bold mb-4 text-orange">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>
        <input type="text" id="user" class="form-control mb-3" placeholder="Username">
        <input type="password" id="pass" class="form-control mb-4" placeholder="Password">
        <button onclick="login()" class="btn btn-orange w-100 shadow">‡∏ï‡∏Å‡∏•‡∏á</button>
    </div>
</div>

<div id="mainSection" class="hidden">
    <nav class="navbar mb-3 p-3 glass-card mx-2 mt-2">
        <div class="container d-flex justify-content-between align-items-center">
            <span class="navbar-brand fw-bold text-orange">üü† V24 ANALYTICS</span>
            <div class="text-center d-none d-md-block">
                <div id="liveClock" class="fw-bold text-secondary small">00:00:00</div>
            </div>
            <div class="d-flex align-items-center gap-2">
                <div class="text-end">
                    <div class="small fw-bold">üë§ <span id="empName"></span></div>
                    <button onclick="logout()" class="btn-logout mt-1">Logout</button>
                </div>
            </div>
        </div>
    </nav>

    <div class="container pb-5">
        <div class="d-flex gap-2 mb-4">
            <button id="nav-rec" class="btn btn-orange nav-btn" onclick="showTab('record')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</button>
            <button id="nav-dash" class="btn btn-outline-secondary nav-btn" onclick="showTab('dash')">Dashboard</button>
            <button id="nav-assign" class="btn btn-outline-secondary nav-btn" onclick="showTab('assign')">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô</button>
        </div>

        <div id="tab-record" class="tab-content">
            <div class="glass-card text-center mb-3">
                <h5 id="displayDateText" class="fw-bold mb-3"></h5>
                <div class="row g-2">
                    <div class="col-6"><div class="stat-box">‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: <span id="displayTarget" class="fw-bold text-orange">0</span></div></div>
                    <div class="col-6"><div class="stat-box" style="border-left-color:var(--green)">‡∏ó‡∏≥‡∏à‡∏£‡∏¥‡∏á‡∏£‡∏ß‡∏°: <span id="displayActual" class="fw-bold text-success">0</span></div></div>
                </div>
            </div>
            <div class="row g-2">
                <div class="col-6 col-md-4"><div class="stat-box">üì¶ CP No. <span class="badge-count" id="count-CP">0</span><input type="text" class="form-control mt-1 cat-input" data-cat="CP No."></div></div>
                <div class="col-6 col-md-4"><div class="stat-box">üìû Call IN <span class="badge-count" id="count-Call">0</span><input type="text" class="form-control mt-1 cat-input" data-cat="Call IN"></div></div>
                <div class="col-6 col-md-4"><div class="stat-box">üìÑ IR <span class="badge-count" id="count-IR">0</span><input type="text" class="form-control mt-1 cat-input" data-cat="IR"></div></div>
                <div class="col-6 col-md-4"><div class="stat-box">üåê GNS <span class="badge-count" id="count-GNS">0</span><input type="text" class="form-control mt-1 cat-input" data-cat="GNS"></div></div>
                <div class="col-6 col-md-4"><div class="stat-box">üõ†Ô∏è SR <span class="badge-count" id="count-SR">0</span><input type="text" class="form-control mt-1 cat-input" data-cat="SR"></div></div>
                <div class="col-6 col-md-4"><div class="stat-box">üéÅ Campaign <span class="badge-count" id="count-Campaign">0</span><input type="text" class="form-control mt-1 cat-input" data-cat="Campaign"></div></div>
            </div>
            <button onclick="saveWork()" class="btn btn-orange w-100 mt-4 py-3 shadow">üöÄ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</button>
        </div>

        <div id="tab-dash" class="tab-content hidden">
            <div class="glass-card mb-3">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="fw-bold text-orange m-0">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h6>
                    <button onclick="refreshView(true)" class="btn btn-sm btn-outline-secondary">üîÑ Refresh</button>
                </div>
                <div class="row g-2">
                    <div class="col-md-3"><select id="viewType" class="form-select" onchange="toggleFilters()"><option value="daily">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</option><option value="monthly">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option><option value="quarterly">‡∏£‡∏≤‡∏¢‡πÑ‡∏ï‡∏£‡∏°‡∏≤‡∏™</option><option value="yearly">‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</option></select></div>
                    <div class="col-md-3" id="divYear"><select id="selYear" class="form-select" multiple onchange="updateSubFilters()"></select></div>
                    <div class="col-md-3" id="divMonth"><select id="selMonth" class="form-select" multiple onchange="updateDayFilter()"></select></div>
                    <div class="col-md-3" id="divDay"><select id="selDay" class="form-select" multiple></select></div>
                </div>
                <button onclick="processDashboard()" class="btn btn-orange w-100 mt-3">‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
            </div>
            <div class="glass-card shadow-sm" style="height: 350px;"><canvas id="perfChart"></canvas></div>
            <div class="glass-card">
                <div class="table-responsive"><table class="table table-sm table-bordered table-custom"><thead><tr><th>‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡πÄ‡∏õ‡πâ‡∏≤</th><th>‡∏à‡∏£‡∏¥‡∏á</th><th>Call</th><th>IR</th><th>CP</th><th>GNS</th><th>SR</th><th>Camp.</th></tr></thead><tbody id="dashTableBody"></tbody></table></div>
            </div>
        </div>

        <div id="tab-assign" class="tab-content hidden">
            <div class="glass-card mb-4">
                <h5 class="fw-bold text-orange mb-3">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</h5>
                <div class="row g-2">
                    <div class="col-md-5"><input type="date" id="planDate" class="form-control"></div>
                    <div class="col-md-4"><select id="planType" class="form-select"><option value="72">‡πÄ‡∏ï‡πá‡∏°‡∏ß‡∏±‡∏ô (72)</option><option value="36">‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ß‡∏±‡∏ô (36)</option></select></div>
                    <div class="col-md-3"><button onclick="savePlan('save')" class="btn btn-orange w-100">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
                </div>
            </div>
            <div class="glass-card"><div class="table-responsive"><table class="table table-sm table-custom text-center"><thead><tr><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>Target</th><th>‡∏•‡∏ö</th></tr></thead><tbody id="planTableBody"></tbody></table></div></div>
        </div>
    </div>
</div>

<script>
    const SCRIPT_URL = '‡πÉ‡∏™‡πà_WEB_APP_URL_‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà'; 
    let currentUser = "", allData = [], allPlans = [], chartInstance = null;

    // ‡∏£‡∏∞‡∏ö‡∏ö Clock
    setInterval(() => {
        if(document.getElementById('liveClock')) document.getElementById('liveClock').innerText = new Date().toLocaleTimeString('th-TH');
    }, 1000);

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Logout (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà)
    function logout() {
        Swal.fire({
            title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonColor: '#ff8c00',
            cancelButtonColor: '#6e7881',
            confirmButtonText: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö',
            cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
        }).then((result) => {
            if (result.isConfirmed) {
                currentUser = "";
                document.getElementById('user').value = "";
                document.getElementById('pass').value = "";
                document.getElementById('mainSection').classList.add('hidden');
                document.getElementById('loginSection').classList.remove('hidden');
                Swal.fire({ icon: 'success', title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß', timer: 1000, showConfirmButton: false });
            }
        });
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Login
    async function login() {
        const u = document.getElementById('user').value.trim();
        const p = document.getElementById('pass').value.trim();
        if(!u || !p) return;
        Swal.showLoading();
        try {
            const res = await (await fetch(`${SCRIPT_URL}?action=login&user=${encodeURIComponent(u)}&pass=${encodeURIComponent(p)}`)).json();
            if (res.status === "success") {
                currentUser = res.name;
                document.getElementById('empName').innerText = res.name;
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('mainSection').classList.remove('hidden');
                await refreshView();
                Swal.close();
            } else { Swal.fire('Error', 'Username ‡∏´‡∏£‡∏∑‡∏≠ Password ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error'); }
        } catch (e) { Swal.fire('Error', '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ', 'error'); }
    }

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô V23 ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ---
    // (‡∏Ç‡πâ‡∏≤‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô refreshView, saveWork, showTab, Dashboard logic ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ code ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö)
    // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏´‡πâ‡∏Å‡πä‡∏≠‡∏õ‡∏õ‡∏µ‡πâ JavaScript ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏≤‡∏Å V23 ‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö
</script>
</body>
</html>
